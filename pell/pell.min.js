(function(global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    (global.pell = factory());
}(this, (function() {
  'use strict';
  var _extends = Object.assign || function(target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }
    return target;
  };
  var defaultActions = {
    bold: {
      icon: '<b>B</b>',
      title: 'Bold',
      result: function result() {
        return exec('bold');
      }
    },
    italic: {
      icon: '<i>I</i>',
      title: 'Italic',
      result: function result() {
        return exec('italic');
      }
    },
    underline: {
      icon: '<u>U</u>',
      title: 'Underline',
      result: function result() {
        return exec('underline');
      }
    },
    strikethrough: {
      icon: '<strike>S</strike>',
      title: 'Strike-through',
      result: function result() {
        return exec('strikethrough');
      }
    },
    heading1: {
      icon: '<b>H<sub>1</sub></b>',
      title: 'Heading 1',
      result: function result() {
        return exec('formatBlock', '<H1>');
      }
    },
    heading2: {
      icon: '<b>H<sub>2</sub></b>',
      title: 'Heading 2',
      result: function result() {
        return exec('formatBlock', '<H2>');
      }
    },
    paragraph: {
      icon: '&#182;',
      title: 'Paragraph',
      result: function result() {
        return exec('formatBlock', '<P>');
      }
    },
    quote: {
      icon: '&#8220; &#8221;',
      title: 'Quote',
      result: function result() {
        return exec('formatBlock', '<BLOCKQUOTE>');
      }
    },
    olist: {
      icon: '&#35;',
      title: 'Ordered List',
      result: function result() {
        return exec('insertOrderedList');
      }
    },
    ulist: {
      icon: '&#8226;',
      title: 'Unordered List',
      result: function result() {
        return exec('insertUnorderedList');
      }
    },
    code: {
      icon: '&lt;/&gt;',
      title: 'Code',
      result: function result() {
        return exec('formatBlock', '<PRE>');
      }
    },
    line: {
      icon: '&#8213;',
      title: 'Horizontal Line',
      result: function result() {
        return exec('insertHorizontalRule');
      }
    },
    link: {
      icon: '&#128279;',
      title: 'Link',
      result: function result() {
        var url = window.prompt('Enter the link URL');
        if (url) exec('createLink', url);
      }
    },
    image: {
      icon: '&#128247;',
      title: 'Image',
      result: function result() {
        var url = window.prompt('Enter the image URL');
        if (url) exec('insertImage', url);
      }
    }
  };
  var defaultClasses = {
    actionbar: 'pell-actionbar',
    button: 'pell-button',
    content: 'pell-content',
    selected: 'pell-button-selected'
  };
  var exec = function exec(command) {
    var value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    document.execCommand(command, false, value);
  };
  var preventTab = function preventTab(event) {
    if (event.which === 9) event.preventDefault();
  };
  var init = function init(settings) {
    var actions = settings.actions ? settings.actions.map(function(action) {
      if (typeof action === 'string') return defaultActions[action];
      else if (defaultActions[action.name]) return _extends({}, defaultActions[action.name], action);
      return action;
    }) : Object.keys(defaultActions).map(function(action) {
      return defaultActions[action];
    });
    var classes = _extends({}, defaultClasses, settings.classes);
    var element = settings.element;
    if (typeof element === 'string') element = document.getElementById(element);
    element.className = 'pell';
    var actionbar = document.createElement('div');
    actionbar.className = classes.actionbar;
    element.appendChild(actionbar);
    var content = settings.element.querySelector('.' + classes.content);
    if (!content) {
      content = document.createElement('div');
      content.contentEditable = true;
      content.className = classes.content;
      content.oninput = function(_ref) {
        var target = _ref.target;
        if (target.firstChild && target.firstChild.nodeType === 3) exec('formatBlock', '<p>');
        else if (content.innerHTML === '<br>') content.innerHTML = '';
        settings.onChange(target.innerHTML);
      };
      content.onkeydown = preventTab;
      element.appendChild(content);
    }
    actions.forEach(function(action) {
      var button = document.createElement('button');
      button.className = classes.button;
      button.innerHTML = action.icon;
      button.title = action.title;
      button.onclick = action.result;
      actionbar.appendChild(button);
      if (action.state) {
        var handler = function handler() {
          return button.classList[action.state() ? 'add' : 'remove'](classes.selected);
        };
        content.addEventListener('keyup', handler);
        content.addEventListener('mouseup', handler);
        button.addEventListener('click', handler);
      }
    });
    if (settings.styleWithCSS) exec('styleWithCSS');
    return element;
  };
  var pell = {
    init: init,
    exec: exec
  };
  return pell;
})));